PKG_CFLAGS = -I$(CURDIR)
PKG_LIBS = -L$(CURDIR) $(CURDIR)/serve.a
SRCDIR = $(CURDIR)
GO = $(shell which go)
R_INC = $(shell R CMD config --cppflags)
R_LDFLAGS = $(shell R CMD config --ldflags)

all: serve.a $(SHLIB)

$(SHLIB): serve.a

serve.a:
	echo $(GO) && CGO_CFLAGS=$(subst --,\-\-,$(R_INC)) CGO_LDFLAGS=$(subst --,\-\-,$(R_LDFLAGS)) $(GO) build -o serve.a -buildmode=c-archive $(SRCDIR)/go/serve.go

clean:
	rm -f $(SRCDIR)/*.o $(SRCDIR)/*.a $(SRCDIR)/symbols.rds
